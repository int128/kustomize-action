# kustomize-action [![ts](https://github.com/int128/kustomize-action/actions/workflows/ts.yaml/badge.svg)](https://github.com/int128/kustomize-action/actions/workflows/ts.yaml)

This is an action to run `kustomize build` in parallel.
`kustomize build` takes a long time if it loads an external resource such as HTTPS or Git.
This action would reduce time by paralell build.


## Getting Started

To run this action:

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: int128/kustomize-action@v1
        id: kustomize
        with:
          kustomization: overlays/*/kustomization.yaml
      - run: find ${{ steps.kustomize.outputs.directory }}
```

When `pattern` of inputs matches to the following files:

```
overlays/development/kustomization.yaml
overlays/production/kustomization.yaml
```

This action writes the generated manifests to a temporary directory, such as:

```
/tmp/somewhere/overlays/development/generated.yaml
/tmp/somewhere/overlays/production/generated.yaml
```

You can get the directory `/tmp/somewhere` from `directory` of outputs.


### Write individual files

You can set `write-individual-files` to write individual files (see [kustomize#960](https://github.com/kubernetes-sigs/kustomize/pull/960)).

```yaml
      - uses: int128/kustomize-action@v1
        with:
          kustomization: overlays/*/kustomization.yaml
          write-individual-files: true
```

This action writes the individual manifests as follows:

```
/tmp/somewhere/overlays/development/apps_v1_deployment_echoserver.yaml
/tmp/somewhere/overlays/development/v1_service_echoserver.yaml
/tmp/somewhere/overlays/production/apps_v1_deployment_echoserver.yaml
/tmp/somewhere/overlays/production/v1_service_echoserver.yaml
```


## Inputs

| Name | Required | Description
|------|----------|------------
| `kustomization` | yes | glob patterns to `kustomization.yaml`
| `base-directory` | no | base directory to compute a relative path to `kustomization.yaml` (default to workspace)
| `max-process` | no | max number of kustomize processes (default to 5)
| `write-individual-files` | no | set true to write individual files (default to `false`)


## Outputs

| Name | Description
|------|------------
| `directory` | directory to results of `kustomize build`
| `files` | multi-line string of files generated by `kustomize build`
